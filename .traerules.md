\# Polycarb Project - AI Coding Rules \& Context



\## 1. 核心架构原则 (Architecture)

\- \*\*Service Layer Pattern\*\*: 

&nbsp; - 所有数据操作必须通过 `DataService` (`src/services/data\_service.py`)。

&nbsp; - \*\*禁止虚构方法\*\*：在调用 `DataService` 的方法前，必须先读取 `src/services/data\_service.py` 确认方法名存在。

&nbsp; - 如果需要新功能（如 `get\_audit\_logs`），必须先在 `DataService` 中定义该方法，再在 UI 层调用。

\- \*\*UI Layer\*\*: 

&nbsp; - 必须通过 `src/components/ui\_manager.py` 或 `st` 直接调用。



\## 2. 技术栈规范 (Tech Stack Constraints)

\- \*\*Streamlit (最新版规范)\*\*:

&nbsp; - \*\*隐藏列 (Hidden Columns)\*\*: 在 `st.data\_editor` 或 `st.dataframe` 的 `column\_config` 中，禁止使用 `hidden=True`（已废弃）。\*\*必须将列的值设为 `None` 来隐藏\*\*。

&nbsp;   - ❌ 错误: `"id": st.column\_config.TextColumn(hidden=True)`

&nbsp;   - ✅ 正确: `"id": None`

&nbsp; - \*\*rerun()\*\*: 使用 `st.rerun()` 而不是 `st.experimental\_rerun()`。



\## 3. 文件路径速查

\- 数据服务: `src/services/data\_service.py`

\- 库存服务: `src/services/inventory\_service.py`

\- 数据管理页: `src/page\_modules/data\_management.py`

